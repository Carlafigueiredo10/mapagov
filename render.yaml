services:
  # Backend Django + Frontend React (tudo junto)
  - type: web
    name: mapagov
    env: python
    region: oregon
    plan: free
    branch: main

    # Build: Executa script de build otimizado
    buildCommand: bash build.sh

    # Start: Gunicorn com workers
    startCommand: gunicorn mapagov.wsgi:application --bind 0.0.0.0:$PORT --workers 2 --timeout 120

    # Vari√°veis de ambiente
    envVars:
      - key: PYTHON_VERSION
        value: 3.13.0

      - key: DEBUG
        value: False

      - key: SECRET_KEY
        generateValue: true

      - key: ALLOWED_HOSTS
        value: mapagov.onrender.com,.onrender.com

      - key: DATABASE_URL
        fromDatabase:
          name: mapagov-db
          property: connectionString

      # IMPORTANTE: Adicione sua OPENAI_API_KEY manualmente no dashboard
      # - key: OPENAI_API_KEY
      #   sync: false

      - key: ENVIRONMENT
        value: production

    # Healthcheck
    healthCheckPath: /

  # Banco de dados PostgreSQL
  - type: pgsql
    name: mapagov-db
    region: oregon
    plan: free
    databaseName: mapagov
    databaseUser: mapagov_user
